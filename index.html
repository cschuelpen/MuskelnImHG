<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Muskeln im HG</title>
    <style>
      :root {
        --bg: #0f1221;
        --card: #171a2b;
        --card-2: #1e2237;
        --text: #e7e9f5;
        --muted: #aab0c5;
        --border: #2a2f49;
        --focus: #7dd3fc;

        --user: #7dd3fc;
        --solution: #e7e9f5;
        --solution-bg: #0b0e1b;

        --warn: #facc15;
        --input-h: 48px;
      }

      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
        padding: 16px;
      }
      .wrap {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        gap: 16px;
      }

      header {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 16px;
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 12px;
        flex-wrap: wrap;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.35);
      }
      header h1 {
        font-size: clamp(18px, 2.6vw, 22px);
        margin: 0;
        letter-spacing: 0.2px;
      }

      .subtext {
        color: var(--muted);
        font-size: 13px;
        line-height: 1.35;
        white-space: pre-line;
        margin-top: 6px;
      }

      .controls {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
        margin-top: 4px;
      }

      button {
        background: var(--card-2);
        color: var(--text);
        border: 1px solid var(--border);
        padding: 10px 12px;
        border-radius: 12px;
        font-size: 14px;
        cursor: pointer;
        transition: 0.12s ease;
        outline: none;
        white-space: nowrap;
        width: auto;
      }
      button:hover {
        transform: translateY(-1px);
        border-color: #3a4163;
      }
      button.primary {
        background: #1b2a52;
        border-color: #2e4e6c;
      }
      button.primary[data-state="shown"] {
        background: #153a2e;
        border-color: #1f6b3d;
        color: #d7ffe5;
      }

      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 10px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.35);
        overflow: auto;
      }

      table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        min-width: 1150px;
        font-size: 15px;
      }
      thead th {
        position: sticky;
        top: 0;
        background: #14182b;
        z-index: 1;
        text-align: left;
        padding: 12px;
        border-bottom: 1px solid var(--border);
        font-weight: 600;
      }
      tbody td {
        padding: 10px 12px;
        border-bottom: 1px solid var(--border);
        vertical-align: top;
        background: #12162a;
        transition: background 0.12s ease;
        white-space: pre-line;
        position: relative;
      }
      tbody tr:nth-child(even) td {
        background: #0f1426;
      }
      tbody tr:hover td {
        background: #151a33;
      }

      .cell-wrap {
        display: grid;
        gap: 8px;
        min-height: 68px;
      }

      .solution {
        color: var(--solution);
        line-height: 1.35;
        white-space: pre-line;
      }
      .solution.hidden-solution {
        color: transparent;
        user-select: none;
        min-height: 18px;
      }

      .user-input {
        width: 100%;
        height: var(--input-h);
        min-height: var(--input-h);
        max-height: 140px;
        resize: vertical;
        border-radius: 8px;
        padding: 6px 8px;
        font-size: 14px;
        color: var(--text);
        background: #060914;
        border: 1px solid var(--border);
        outline: none;
        line-height: 1.35;
      }
      .user-input:focus {
        border-color: var(--focus);
        box-shadow: 0 0 0 3px rgba(125, 211, 252, 0.12);
      }
      .user-input:disabled {
        opacity: 0.55;
        cursor: not-allowed;
      }

      /* leere Inputs gelb im Lösungsmodus */
      body.solutions-shown .user-input.empty-input {
        border-color: rgba(250, 204, 21, 0.9);
        box-shadow: 0 0 0 3px rgba(250, 204, 21, 0.12);
      }

      body.solutions-shown .user-input {
        color: var(--user);
        border-color: #294a63;
        background: #050816;
      }
      body.solutions-shown .solution {
        background: var(--solution-bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 6px 8px;
      }

      .row-btn {
        width: 100%;
        font-size: 13px;
        padding: 8px 10px;
      }

      /* Mobile: Tabelle -> Karten */
      @media (max-width: 800px) {
        body {
          padding: 12px;
        }
        .card {
          padding: 8px;
          overflow: visible;
        }

        table {
          min-width: 0;
          width: 100%;
        }
        thead {
          display: none;
        }

        tbody,
        tr,
        td {
          display: block;
          width: 100%;
        }
        tbody tr {
          background: #0f1426;
          border: 1px solid var(--border);
          border-radius: 14px;
          margin-bottom: 12px;
          overflow: hidden;
        }
        tbody td {
          border-bottom: 1px solid var(--border);
          background: transparent;
          padding: 10px 12px 12px;
        }

        tbody td::before {
          content: attr(data-label);
          display: block;
          font-size: 12px;
          font-weight: 700;
          color: var(--muted);
          margin-bottom: 6px;
          letter-spacing: 0.2px;
        }

        .row-btn {
          font-size: 14px;
          padding: 10px 12px;
        }
        :root {
          --input-h: 52px;
        }
        .cell-wrap {
          min-height: auto;
          gap: 6px;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div>
          <h1>Muskeln im HG</h1>
          <div class="subtext">
            Eine zufällige Eigenschaft pro Muskel sichtbar. Sofern nicht
            eindeutig, kann eine weitere Eigenschaft über "Aktion" angezeigt
            werden. Die erwartete Menge an Antworten ist im Eingabefeld
            ersichtlich (war wohl auch in der Vorjahresklausur so). Viel Spaß
            beim Lernen (:
          </div>
        </div>

        <div class="controls">
          <button id="newQuizBtn">Mischen und erneut abfragen</button>
          <button id="toggleBtn" class="primary" data-state="hidden">
            Lösungen zeigen
          </button>
        </div>
      </header>

      <div class="card">
        <table id="studyTable">
          <thead>
            <tr>
              <th>Bezeichnung</th>
              <th>Muskelursprung</th>
              <th>Muskelansatz</th>
              <th>Innervation</th>
              <th>Funktion</th>
              <th>Besonderheit</th>
              <th>Aktion</th>
            </tr>
          </thead>
          <tbody>
            <!-- Tabelleninhalte -->
            <tr>
              <td>M. glutaeus medius</td>
              <td>
                Außenfläche des Os ilium zwischen Linea glutaea anterior und
                posterior
              </td>
              <td>Außenfläche des Trochanter major</td>
              <td>N. glutaeus superior (L4–S1)</td>
              <td>
                ABD; Stabilisation des Beckens in der Standbeinphase; Flex
                (ventraler Anteil);IR (ventraler Anteil);Ext (dorsaler
                Anteil);AR (dorsaler Anteil)
              </td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>M. glutaeus minimus</td>
              <td>
                Außenfläche des Os ilium zwischen Linea glutaea anterior und
                inferior
              </td>
              <td>ventraler Rand Trochanter major</td>
              <td>N. glutaeus superior (L4–S1)</td>
              <td>
                ABD; Stabilisation des Beckens in der Standbeinphase; Flex
                (ventraler Anteil);IR (ventraler Anteil); Ext (dorsaler
                Anteil);AR (dorsaler Anteil)
              </td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>M. pectineus</td>
              <td>Pecten ossis pubis; Tuberculum pubicum</td>
              <td>Linea pectinea (caudal Trochanter minor)</td>
              <td>N. femoralis; N. obturatorius (L3)</td>
              <td>Flex; ADD; AR</td>
              <td>In 90° Flex HG: IR</td>
              <td></td>
            </tr>
            <tr>
              <td>M. gracilis</td>
              <td>Ramus inferior ossis pubis caudal der Symphyse</td>
              <td>
                Pes anserinus superficialis (medial der Tuberositas tibiae)
              </td>
              <td>N. obturatorius (L2–L4)</td>
              <td>
                ADD (HG); Flex (HG) bis 50° danach Ext; Flex (KG); IR (KG)
              </td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>M. adductor longus</td>
              <td>
                Ramus sup. ossis pubis; Tuberculum pubicum ventral der Symphyse
              </td>
              <td>Labium mediale der Linea aspera (mittleres Drittel)</td>
              <td>N. obturatorius (L2–L4)</td>
              <td>ADD; Flex bis 70°, danach Ext</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>M. adductor brevis</td>
              <td>Ramus inf. ossis pubis</td>
              <td>Labium mediale der Linea aspera (craniales Drittel)</td>
              <td>N. obturatorius (L2–L4)</td>
              <td>ADD; Flex bis 50°</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>M. adductor magnus</td>
              <td>
                Ramus inf. ossis pubis; Ramus ossis ischii; Tuber ischiadicum
              </td>
              <td>
                Labium mediale der Linea aspera (proximaler Anteil); Tuberculum
                adductorium
              </td>
              <td>
                N. obturatorius (L3–L4); N. ischiadicus (L4–L5) - tibialer
                Anteil
              </td>
              <td>ADD; Ext (distaler Anteil: IR)</td>
              <td>
                Muskel liegt zu einem großen Anteil dorsal, daher Funktion
                Extension
              </td>
              <td></td>
            </tr>
            <tr>
              <td>M. obturatorius externus</td>
              <td>
                Außenseite Membrana obturatoria; Außenseite Ramus ossis ischii
              </td>
              <td>Fossa trochanterica</td>
              <td>N. obturatorius (L3–L4)</td>
              <td>AR; ADD</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>M. obturatorius internus</td>
              <td>
                Innenseite Membrana obturatoria, caudal der Linea terminales
              </td>
              <td>Fossa trochanterica</td>
              <td>Plexus sacralis (L5–S2)</td>
              <td>AR; ADD; Ext</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>M. quadratus femoris</td>
              <td>Tuber ischiadicum</td>
              <td>Crista trochanterica</td>
              <td>
                Plexus sacralis; N. gluteaus inferior; N. ischiadicus (L5-S2)
              </td>
              <td>AR; ADD</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>M. piriformis</td>
              <td>Facies pelvica ossis sacri</td>
              <td>Apex trochanterica</td>
              <td>Plexus sacralis (L5–S1)</td>
              <td>AR; ABD</td>
              <td>in 90° Flex: IR</td>
              <td></td>
            </tr>
            <tr>
              <td>M. gemellus superior</td>
              <td>Spina ischiadica</td>
              <td>Fossa trochanterica</td>
              <td>Plexus sacralis; N. glutaeus inf. (L5–S2)</td>
              <td>AR; ADD; Ext</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>M. gemellus inferior</td>
              <td>Tuber ischiadicum</td>
              <td>Fossa trochanterica</td>
              <td>Plexus sacralis; N. glutaeus inf. (L5–S2)</td>
              <td>AR; ADD; Ext</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>M. tensor fasciae latae</td>
              <td>Spina iliaca anterior superior</td>
              <td>in Höhe Trochanter major in den Tractus iliotibialis</td>
              <td>Plexus sacralis; N. glut. Superior (L5-S2)</td>
              <td>Flex; ABD; IR</td>
              <td>
                Tractus iliotibialis (von Crista iliaca bis Condylus lat.
                Tibiae) ist ein sehniger Verstärkungszug der Fascia lata.
                Fasterzüge strahlen in KG ein. Funktion: Zuggurtung gegen
                Biegungstendenz des Femurs nach lateral
              </td>
              <td></td>
            </tr>
            <tr>
              <td>M. sartorius</td>
              <td>Spina iliaca anterior superior</td>
              <td>Pes anserinus superficialis</td>
              <td>N. femoralis (L2–L3)</td>
              <td>Flex (HG); ABD (HG); AR (HG); Flex (KG); IR (KG)</td>
              <td>
                Pes anserinus superficalis umfasst auch M. semitendinosus und M.
                gracilis
              </td>
              <td></td>
            </tr>
            <tr>
              <td>M. rectus femoris</td>
              <td>Spina iliaca anterior inferior; ventrales Pfannendach</td>
              <td>Basis patellae (Endsehne 8-10cm); Tuberositas tibiae</td>
              <td>N. femoralis (L2–L4)</td>
              <td>Flex (HG), Ext (KG)</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>M. psoas major</td>
              <td>
                Seitenflächen der Wirbelkörper Th12–L4; Proc. costarii der LWK
                1–4
              </td>
              <td>Trochanter minor</td>
              <td>N. femoralis; Plexus lumbalis (Th12–L3)</td>
              <td>Flex; AR</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>M. iliacus</td>
              <td>
                Fossa iliaca bis Linea terminalis; Spina iliaca anterior
                inferior (SIAI)
              </td>
              <td>Trochanter minor</td>
              <td>N. femoralis; Plexus lumbalis (Th12–L3)</td>
              <td>Flex; AR</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>M. glutaeus maximus</td>
              <td>
                Crista iliaca; SIPS; Außenfläche Os ilium medial der Linea
                glutea posterior; Seitenrand Os sacrum + Os coccygis; Lig.
                Sacrotuberale
              </td>
              <td>
                cranialer Anteil: Höhe Trochanter major in Fascia lata; caudaler
                Anteil: Tuberositas glutea
              </td>
              <td>N. glutaeus inferior (L4–S1))</td>
              <td>Ext; AR;ABD (cranialer Anteil); ADD (caudaler Anteil)</td>
              <td>
                aus 90° Flex am besten wirksam (auf hohen Kasten steigen), beim
                Aufstehen aus Sitz. Hocke, Klettern, Rumpfaufrichtung, Kontrolle
                Treppabgehen und Bücken, im Stand und beim Gehen wenig
                Aktivität. Autoantagonismus: ADD und ABD
              </td>
              <td></td>
            </tr>
            <tr>
              <td>M. semitendinosus</td>
              <td>Tuber ischiadicum</td>
              <td>Pes anserinus superficialis</td>
              <td>N. ischiadicus, tibial (L5–S2)</td>
              <td>Ext (HG); Flex (KG); IR (KG)</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>M. semimembranosus</td>
              <td>Tuber ischiadicum</td>
              <td>Pes anserinus profundus</td>
              <td>N. ischiadicus, tibial (L5–S2)</td>
              <td>Ext (HG); Flex (KG); IR (KG)</td>
              <td>
                Ansatz: Condylus medialis tibiae dorsal und medial + als Teil
                des Lig. Popliteum obliquum + Einstrahlung in Fascie des M.
                popliteus
              </td>
              <td></td>
            </tr>
            <tr>
              <td>M. biceps femoris – Caput longum</td>
              <td>Tuber ischiadicum; Lig. sacrotuberale</td>
              <td>
                Zusammen mit Caput breve in einer Ansatzsehne am Caput fibulae;
                Faseranteile zum Condylus lateralis tibiae
              </td>
              <td>N. ischiadicus, tibialer Anteil (S1–S2))</td>
              <td>Ext (HG); Flex (KG); AR (KG)</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>M. biceps femoris – Caput breve</td>
              <td>FLabium laterale der Linea aspera (mittleres Drittel)</td>
              <td>
                Zusammen mit Caput longum in einer Ansatzsehne am Caput fibulae;
                Faseranteile zum Condylus lateralis tibiae
              </td>
              <td>N. ischiadicus, peronealer Anteil (L5–S1)</td>
              <td>Flex (KG); AR (KG)</td>
              <td></td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <script>
      const table = document.getElementById("studyTable");
      const toggleBtn = document.getElementById("toggleBtn");
      const newQuizBtn = document.getElementById("newQuizBtn");

      let solutionsShown = false;
      const rowState = new Map();

      function getHeaderLabels() {
        return [...table.tHead.rows[0].cells].map((th) =>
          th.textContent.trim()
        );
      }

      function countItems(text) {
        const t = (text ?? "").toString().trim();
        if (t === "") return 0;

        // NUR Semikolon trennt Antworten
        return t
          .split(";")
          .map((s) => s.trim())
          .filter(Boolean).length;
      }

      function ensureActionButtons() {
        [...table.tBodies[0].rows].forEach((row) => {
          const actionCell = row.cells[row.cells.length - 1];
          actionCell.dataset.actionCell = "true";
          if (!actionCell.querySelector("button")) {
            const btn = document.createElement("button");
            btn.className = "row-btn";
            btn.textContent = "Nicht eindeutig? Weiteren Eintrag anzeigen.";
            btn.addEventListener("click", () => revealNextInRow(row));
            actionCell.appendChild(btn);
          }
        });
      }

      function setMobileLabels() {
        const labels = getHeaderLabels();
        [...table.tBodies[0].rows].forEach((row) => {
          [...row.cells].forEach((td, i) =>
            td.setAttribute("data-label", labels[i] || "")
          );
        });
      }

      function wrapStudyCellsWithInputs() {
        const headersLower = getHeaderLabels().map((h) => h.toLowerCase());
        const actionIndex = headersLower.indexOf("aktion");

        [...table.tBodies[0].rows].forEach((row) => {
          [...row.cells].forEach((td, colIndex) => {
            if (colIndex === actionIndex) return;
            if (td.dataset.wrapped === "true") return;

            const original = td.textContent.trim();
            const expected = countItems(original); // kann 0 sein
            td.dataset.expectedCount = expected;

            td.textContent = "";
            const wrap = document.createElement("div");
            wrap.className = "cell-wrap";

            const sol = document.createElement("div");
            sol.className = "solution";
            sol.textContent = original;
            wrap.appendChild(sol);

            const input = document.createElement("textarea");
            input.className = "user-input";
            input.placeholder = `(${expected} Antworten)`;
            input.dataset.userControl = "true";

            // bei 0 Antworten deaktivieren
            if (expected === 0) {
              input.disabled = true;
            }

            wrap.appendChild(input);

            td.appendChild(wrap);
            td.dataset.wrapped = "true";
          });
        });
      }

      function shuffleRows() {
        const tbody = table.tBodies[0];
        const rows = [...tbody.rows];
        for (let i = rows.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [rows[i], rows[j]] = [rows[j], rows[i]];
        }
        rows.forEach((r) => tbody.appendChild(r));
      }

      function buildRandomOrderForRow(row) {
        const cells = [...row.cells];
        const actionIndex = cells.findIndex(
          (c) => c.dataset.actionCell === "true"
        );

        const usable = cells
          .map((c, i) => ({
            i,
            t: c.querySelector(".solution")?.textContent.trim() ?? "",
          }))
          .filter((x) => x.i !== actionIndex && x.t.length > 0)
          .map((x) => x.i);

        const order = usable.slice();
        for (let i = order.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [order[i], order[j]] = [order[j], order[i]];
        }

        rowState.set(row, { order, revealedCount: 1, actionIndex });
      }

      function randomizeAllRows() {
        [...table.tBodies[0].rows].forEach(buildRandomOrderForRow);
      }

      function revealNextInRow(row) {
        const state = rowState.get(row);
        if (!state) return;
        if (state.revealedCount < state.order.length) {
          state.revealedCount++;
          applyMaskingToRow(row);
        }
      }

      function markEmptyInputsInRow(row) {
        row.querySelectorAll(".user-input").forEach((inp) => {
          if (inp.disabled) return; // ✅ nicht markieren bei 0 Antworten
          inp.classList.toggle("empty-input", !inp.value.trim());
        });
      }
      function clearEmptyMarks(row) {
        row.querySelectorAll(".user-input").forEach((inp) => {
          inp.classList.remove("empty-input");
        });
      }

      function applyMaskingToRow(row) {
        const state = rowState.get(row);
        const cells = [...row.cells];
        const { order, revealedCount, actionIndex } = state;

        // was war vor Lösungsmodus schon sichtbar?
        const revealedSet = new Set(order.slice(0, revealedCount));

        // wenn Lösungen NICHT gezeigt:
        if (!solutionsShown) {
          const visible = revealedSet;
          cells.forEach((cell, i) => {
            if (i === actionIndex) return;

            const sol = cell.querySelector(".solution");
            const input = cell.querySelector(".user-input");
            if (!sol || !input) return;

            if (visible.has(i)) {
              sol.classList.remove("hidden-solution");
              input.style.display = "none";
            } else {
              sol.classList.add("hidden-solution");
              input.style.display = "";
            }
          });

          clearEmptyMarks(row);
          return;
        }

        // Lösungen gezeigt: alle Lösungen sichtbar,
        // aber Inputs nur dort, wo NICHT zuvor vorgegeben.
        cells.forEach((cell, i) => {
          if (i === actionIndex) return;

          const sol = cell.querySelector(".solution");
          const input = cell.querySelector(".user-input");
          if (!sol || !input) return;

          sol.classList.remove("hidden-solution");
          input.style.display = revealedSet.has(i) ? "none" : "";
        });

        markEmptyInputsInRow(row);
      }

      function applyMasking() {
        [...table.tBodies[0].rows].forEach(applyMaskingToRow);
        toggleBtn.textContent = solutionsShown
          ? "Lösungen verbergen"
          : "Lösungen zeigen";
        toggleBtn.dataset.state = solutionsShown ? "shown" : "hidden";
        document.body.classList.toggle("solutions-shown", solutionsShown);
      }

      function resetInputs() {
        table.querySelectorAll(".user-input").forEach((i) => {
          i.value = "";
        });
      }

      newQuizBtn.addEventListener("click", () => {
        solutionsShown = false;
        resetInputs();
        shuffleRows();
        setMobileLabels();
        randomizeAllRows();
        applyMasking();
      });

      toggleBtn.addEventListener("click", () => {
        solutionsShown = !solutionsShown;
        applyMasking();
      });

      // INIT
      ensureActionButtons();
      wrapStudyCellsWithInputs();
      shuffleRows();
      setMobileLabels();
      randomizeAllRows();
      applyMasking();
    </script>
  </body>
</html>
